---
title: "Gibbs Sampling in the Ising Model"
author: "Zack Nadrich"
date: "9/7/2019"
output: pdf_document
---

# Sampling from $p(x)$

$p(x) \propto exp(\beta \sum_{s\sim t} x_sx_t), \ x\in\{-1, 1\}\\\\$
\newline
$p(x_s|_sx) = \dfrac{p(x_s, _sx)}{p(_sx)} = \dfrac{p(\textbf{x})}{p(_sx)}\\\\$
\newline
$= \dfrac{\dfrac{1}{Z}exp(\beta \sum_{s\sim t}x_sx_t)}{\sum_{x`_s}\dfrac{1}{Z}exp(\beta \sum_{s\sim t} x'_sx_t)} \\\\$
\newline
$= \dfrac{\exp(\beta \sum_{t:t\in\eta_s} x_sx_t)}{\sum_{x`_s}exp(\beta \sum_{t:t\in\eta_s} x'_sx_t)} \\\\$
\newline
$= \dfrac{\exp(\beta \sum_{t:t\in\eta_s} x_sx_t)}{exp(-\beta \sum_{t:t\in\eta_s} x'_sx_t) + exp(\beta \sum_{t:t\in\eta_s} x'_sx_t)} \\\\$
\newline
$\implies\begin{cases}& p(x_s=1|_sx) = \dfrac{\exp(\beta \sum_{t:t\in\eta_s} x_t)}{exp(- \beta \sum_{t:t\in\eta_s} x_t) + exp(\beta \sum_{t:t\in\eta_s} x_t)}\propto\exp(\beta \sum_{t:t\in\eta_s} x_t)\\\\& p(x_s=-1|_sx) = \dfrac{\exp(-\beta \sum_{t:t\in\eta_s} x_t)}{exp(-\beta \sum_{t:t\in\eta_s} x_t) + exp(\beta \sum_{t:t\in\eta_s} x_t)}\propto\exp(-\beta \sum_{t:t\in\eta_s} x_t) \\\\\end{cases}$
\newpage
```{r, include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
```


```{r}

prop_x <- function(val, neighborhood, beta){
  sum_neigh <- sum(neighborhood)
  p <- exp(val*beta*sum_neigh)
  return(p)
}

neighborhood_eval <- function(n_pos, n_neg){
  beta <- seq(-1, 1, by = .05)
  x_nhood_vals <- c(rep(1, n_pos), rep(-1, n_neg))
  x_nhood_vals <- x_nhood_vals[sample(8, 8)]
  v <- c(x_nhood_vals[1:4], 0, x_nhood_vals[5:8])
  x_nhood <- matrix(v, 3, 3)
  
  prop_1 <- numeric(length(beta))
  prop_neg_1 <- numeric(length(beta))
  for(i in seq_along(beta)){
    prop_1[i] = prop_x(1, x_nhood, beta[i])
    prop_neg_1[i] = prop_x(-1, x_nhood, beta[i])
  }
  
  r <- data.frame(
    pos = prop_1, 
    neg = prop_neg_1, 
    beta = beta,
    pos_neg = paste(n_pos, n_neg, sep = ':')
  )
  return(r)
}

neigh <- 0:8

sims <- lapply(seq_along(neigh), function(i){
  pos <- neigh[i]
  neg <- neigh[8-i+2]
  neighborhood_eval(pos, neg)
})

sims_df <- sims %>% 
  do.call(rbind, .) %>%
  gather(-c(beta, pos_neg), key = "X", value = "energy")

sims_df %>%
  ggplot(aes(x = beta, y = log(energy), color = X)) +
  geom_line() +
  facet_wrap(pos_neg~., scales = "fixed") +
  theme_bw() +
  ggtitle("Pos : Neg")
```

